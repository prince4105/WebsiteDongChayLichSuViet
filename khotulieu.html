<!doctype html>
<html lang="vi" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kho tư liệu — Dòng Chảy Lịch Sử Việt</title>
  <meta name="description" content="Kho tư liệu: ảnh, bản đồ, tài liệu tham khảo và video minh họa — lưu trữ & xem trực tiếp trên trình duyệt (tĩnh)." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400;0,600;0,700;1,400&family=Inter:wght@300;400;500;600;700&family=Praise&display=swap" rel="stylesheet">
  <style>
  :root {
      /* === Bảng màu Light Mode === */
      --bg-light: #fdfbf6; /* Be kem */
      --card-light: #ffffff;
      --primary-light: #a12126; /* Đỏ đô đậm */
      --accent-light: #b48c47; /* Vàng đồng */
      --text-light: #3a2e27; /* Nâu đậm */
      --muted-light: #7a6a5f; /* Nâu xám nhạt */
      --border-light: #e5e0db; /* Xám be */
      --shadow-light: 0 12px 35px rgba(90, 70, 58, 0.1); /* Shadow đậm hơn */
      --glass-light: rgba(253, 251, 246, 0.85); /* Nền kính sáng */
      --input-bg-light: #f8f5f2;
      /* Họa tiết vân mây nhẹ */
      --pattern-light: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Cg fill-rule='evenodd'%3E%3Cg fill='%23e5e0db' fill-opacity='0.1'%3E%3Cpath opacity='.5' d='M96 95h4v1h-4v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9zm-1 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm9-10v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm9-10v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm9-10v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9z'/%3E%3Cpath d='M6 6v4h4V6H6zm10 0v4h4V6h-4zm10 0v4h4V6h-4zm10 0v4h4V6h-4zm10 0v4h4V6h-4zm10 0v4h4V6h-4zm10 0v4h4V6h-4zm10 0v4h4V6h-4zM6 16v4h4v-4H6zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zM6 26v4h4v-4H6zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zM6 36v4h4v-4H6zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zM6 46v4h4v-4H6zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zM6 56v4h4v-4H6zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zM6 66v4h4v-4H6zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zM6 76v4h4v-4H6zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zM6 86v4h4v-4H6zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");

      /* === Bảng màu Dark Mode === */
      --bg-dark: #000000; /* Đen tuyền */
      --card-dark: #1a1816; /* Xám đen đậm hơn */
      --primary-dark: var(--accent-light); /* Vàng đồng */
      --accent-dark: #cea86a; /* Vàng đồng sáng hơn */
      --text-dark: #e0daca; /* Be sáng */
      --muted-dark: #9c938a; /* Xám be nhạt */
      --border-dark: #3a3631; /* Nâu xám đậm hơn */
      --shadow-dark: 0 16px 50px rgba(0, 0, 0, 0.5); /* Shadow mạnh hơn */
      --glass-dark: rgba(26, 24, 22, 0.85); /* Nền kính tối */
      --input-bg-dark: #2f2c29;
      --pattern-dark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Cg fill-rule='evenodd'%3E%3Cg fill='%233a3631' fill-opacity='0.1'%3E%3Cpath opacity='.5' d='M96 95h4v1h-4v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9zm-1 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm9-10v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm9-10v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm9-10v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9z'/%3E%3Cpath d='M6 6v4h4V6H6zm10 0v4h4V6h-4zm10 0v4h4V6h-4zm10 0v4h4V6h-4zm10 0v4h4V6h-4zm10 0v4h4V6h-4zm10 0v4h4V6h-4zm10 0v4h4V6h-4zM6 16v4h4v-4H6zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zM6 26v4h4v-4H6zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zM6 36v4h4v-4H6zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zM6 46v4h4v-4H6zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zM6 56v4h4v-4H6zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zM6 66v4h4v-4H6zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zM6 76v4h4v-4H6zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zM6 86v4h4v-4H6zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4zm10 0v4h4v-4h-4z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");

      /* === Thiết lập ban đầu (Light) === */
      --bg: var(--bg-light); --card: var(--card-light); --primary: var(--primary-light); --accent: var(--accent-light);
      --text: var(--text-light); --muted: var(--muted-light); --border: var(--border-light); --shadow: var(--shadow-light);
      --glass-bg: var(--glass-light); --input-bg: var(--input-bg-light); --pattern: var(--pattern-light);

      --radius: 12px; --radius-sm: 8px; --maxw: 1280px; --header-height: 72px;

      /* Font Families */
      --font-body: 'Inter', system-ui, Arial, sans-serif;
      --font-heading: 'EB Garamond', serif;
      --font-display: 'Praise', cursive; /* Font thư pháp ấn tượng */
    }
    [data-theme="dark"]{
      --bg: var(--bg-dark); --card: var(--card-dark); --primary: var(--primary-dark); --accent: var(--accent-dark);
      --text: var(--text-dark); --muted: var(--muted-dark); --border: var(--border-dark); --shadow: var(--shadow-dark);
      --glass-bg: var(--glass-dark); --input-bg: var(--input-bg-dark); --pattern: var(--pattern-dark);
    }
    *, *::before, *::after { box-sizing: border-box; }
    html{scroll-behavior:smooth}
    body{
        margin:0; padding: 0; font-family: var(--font-body); background-color: var(--bg);
        background-image: var(--pattern); color: var(--text); transition: background 0.3s, color 0.3s;
        padding-top: var(--header-height); font-size: 16px; line-height: 1.7; /* Tăng line-height hơn nữa */
        -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
    }
    a{color:var(--primary);text-decoration:none; transition: color 0.2s ease-out, opacity 0.2s ease-out;}
    a:hover { color: var(--accent); opacity: 0.85; text-decoration: none;} /* Bỏ gạch chân mặc định */
    img { max-width: 100%; height: auto; display: block; border-radius: var(--radius-sm); }

    .wrap{max-width:var(--maxw); margin:0 auto; padding: 0 40px;} /* Tăng padding wrap */

    /* === Header Cố Định Dạng Kính === */
    .sticky-header {
        position: fixed; top: 0; left: 0; width: 100%; z-index: 1000;
        background: var(--glass-bg); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); /* Blur mạnh hơn */
        border-bottom: 1px solid var(--border); transition: background 0.3s, border 0.3s, box-shadow 0.3s;
        height: var(--header-height); display: flex; align-items: center;
        box-shadow: 0 2px 10px rgba(0,0,0,0.03); /* Thêm shadow nhẹ */
    }
     [data-theme="dark"] .sticky-header { box-shadow: 0 4px 15px rgba(0,0,0,0.2); }

    .header-container { display: flex; justify-content: space-between; align-items: center; width: 100%; }
    .header-brand { display: flex; align-items: center; gap: 14px; color: var(--primary); transition: transform 0.2s ease-out;}
    .header-brand:hover { transform: scale(2.03); } /* Hiệu ứng hover logo */
    .main-navigation ul { display: flex; gap: 8px; list-style: none; margin: 0; padding: 0; }
    .main-navigation a {
        display: block; padding: 10px 18px; font-weight: 500; color: var(--text); border-radius: 8px;
        transition: background 0.2s, color 0.2s, transform 0.2s; font-size: 1rem; position: relative;
    }
    .main-navigation a:hover { background: var(--glass); color: var(--primary); transform: translateY(-2px); }
    .main-navigation a.active-page { color: var(--primary); font-weight: 600; background: transparent; }
    .main-navigation a.active-page::after {
        content: ''; position: absolute; bottom: 5px; left: 18px; right: 18px; height: 3px;
        background: var(--primary); border-radius: 1.5px;
        animation: slideIn 0.3s ease-out; /* Hiệu ứng gạch chân */
    }
    @keyframes slideIn { from { width: 0; left: 50%; } to { width: calc(100% - 36px); left: 18px; } }
    [data-theme="dark"] .main-navigation a.active-page { color: var(--primary); }
    [data-theme="dark"] .main-navigation a.active-page::after { background: var(--primary); }

    .header-actions { display: flex; align-items: center; gap: 12px; }
    .icon-btn{
        background: transparent; border: 1px solid var(--border); padding: 12px; /* Lớn hơn */
        border-radius: 10px; color: var(--muted); cursor: pointer;
        transition: all 0.2s ease-out; line-height: 1; display: flex;
        align-items: center; justify-content: center; position: relative;
    }
    .icon-btn:hover { background: var(--glass); border-color: var(--primary); color: var(--primary); transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.05);}
    .icon-btn svg { width: 18px; height: 18px; } /* Kích thước icon chuẩn */

    #theme-toggle .theme-icon-dark, #theme-toggle .theme-icon-light { transition: opacity 0.3s; }

    /* Nội dung chính */
    .content-area { padding: 64px 0; } /* Tăng padding */

    /* Page Header */
    .page-header {
        margin-bottom: 48px; text-align: center; position: relative; padding: 20px 0;
    }
     .page-header::before, .page-header::after { /* Đường kẻ trang trí */
        content: ''; position: absolute; left: 50%; width: 100px; height: 1px;
        background: linear-gradient(to right, transparent, var(--accent), transparent);
        transform: translateX(-50%);
    }
    .page-header::before { top: 0; }
    .page-header::after { bottom: 0; }

    h1.page-title{
        margin:0 0 16px 0; color:var(--text); font-family: var(--font-display); /* Font thư pháp */
        font-size: 5rem; /* Rất lớn */ font-weight: 400; /* Thường font thư pháp chỉ có weight 400 */
        line-height: 1.1; letter-spacing: 1px; color: var(--primary);
    }
    .page-subtitle{color:var(--muted); font-size: 1.2rem; max-width: 700px; margin: 0 auto; line-height: 1.8; font-family: var(--font-heading); font-style: italic;}


    /* Main Card */
    main.card{
        background:var(--card); padding: 48px; border-radius:var(--radius);
        box-shadow:var(--shadow); border: 1px solid var(--border);
        transition: background 0.3s, border 0.3s;
        background-image: var(--pattern); background-size: 80px 80px; /* Họa tiết lớn hơn */
        background-blend-mode: multiply; /* Hòa trộn họa tiết */
        position: relative; /* Cho họa tiết trang trí góc */
    }
    
    .controls-container { display: flex; flex-direction: column; gap: 24px; margin-bottom: 40px; padding-bottom: 32px; border-bottom: 1px solid var(--border); }
    .search-bar{display:flex;gap:12px;}
    .search-bar input{
        flex:1; padding:16px 20px; border-radius: var(--radius-sm); border: 1px solid var(--border);
        background: var(--input-bg); color:inherit; font-size: 1rem; transition: all 0.2s;
        box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
    }
     .search-bar input:focus {
        outline: none; border-color: var(--primary); background: var(--card);
        box-shadow: 0 0 0 4px var(--glass), inset 0 1px 2px rgba(0,0,0,0.06);
    }
    .filters{display:flex;gap:12px;flex-wrap:wrap;}
    .tag{ /* Giống thẻ tre/dấu triện */
        padding: 10px 20px; border-radius: var(--radius-sm); background: transparent; /* Nền trong */
        cursor: pointer; font-weight: 500; color: var(--muted);
        border: 1px solid var(--border); transition: all 0.2s ease-out;
        font-size: 0.95rem; letter-spacing: 0.3px; position: relative; overflow: hidden;
    }
    .tag::before { /* Hiệu ứng nền chạy khi hover */
        content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
        background: var(--glass); z-index: -1; transition: left 0.3s ease-out;
    }
    .tag:hover::before { left: 0; }
    .tag:hover { border-color: var(--accent); color: var(--accent); }
    .tag.active{
        background: var(--primary); color: #fff; border-color: var(--primary);
        font-weight: 600; box-shadow: 0 5px 15px rgba(161, 33, 38, 0.2);
    }
    .tag.active::before { display: none; } /* Bỏ hiệu ứng hover khi active */
    [data-theme="dark"] .tag.active { color: var(--bg-dark); box-shadow: 0 5px 15px rgba(180, 140, 71, 0.25); }
    [data-theme="dark"] .tag:hover { color: var(--primary); border-color: var(--primary); }

    /* Toolbar & Filters - Sử dụng lại CSS từ vanhoa.html */
    .toolbar{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-bottom:12px; padding-bottom: 12px; border-bottom: 1px solid var(--border);}
    .search{flex:1;display:flex;gap:8px;}
    .search input{
        flex:1; padding:10px; border-radius:10px; border:1px solid var(--border);
        background: var(--input-bg); color:inherit; font-size: 1rem; transition: all 0.2s;
        box-shadow: inset 0 1px 3px rgba(0,0,0,0.05); font-family: var(--font-body);
    }
    .search input:focus { outline: none; border-color: var(--primary); background: var(--card); box-shadow: 0 0 0 4px rgba(var(--primary-rgb, 161, 33, 38), 0.1), inset 0 1px 2px rgba(0,0,0,0.06); }
    :root { --primary-rgb: 161, 33, 38; } [data-theme="dark"] { --primary-rgb: 180, 140, 71; }
    [data-theme="dark"] .search input{border-color: var(--border); background: var(--input-bg);}

    .filters{display:flex;gap:8px;align-items:center;flex-wrap:wrap; font-family: var(--font-body);}
    .filter-btn{
        padding:8px 10px; border-radius:10px; border:1px solid var(--border); background: var(--glass-bg);
        cursor:pointer; font-weight: 500; color: var(--muted); transition: all 0.2s ease-out;
    }
    .filter-btn:hover { border-color: var(--accent); color: var(--accent); background: transparent; }
    .filter-btn.active{
        background: var(--primary); color: #fff; border-color: var(--primary);
        font-weight: 600; box-shadow: 0 4px 10px rgba(161, 33, 38, 0.2);
    }
    [data-theme="dark"] .filter-btn.active { background: var(--primary); color: var(--bg-dark); box-shadow: 0 4px 10px rgba(180, 140, 71, 0.2); }


    /* Grid & List Styles - Tinh chỉnh lại style Card và Doc List */
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-top:16px}
    .resource{
        background:var(--card); padding:16px; border-radius:var(--radius-sm); border:1px solid var(--border);
        display:flex; flex-direction:column; gap:8px; transition: transform 0.3s ease-out, box-shadow 0.3s ease-out;
        box-shadow: 0 4px 10px rgba(0,0,0,0.03);
    }
    .resource:hover { transform: translateY(-5px); box-shadow: var(--shadow-light); }
    .resource img{width:100%;height:180px;object-fit:cover;border-radius:6px; border: 1px solid var(--border);}
    .resource strong { font-family: var(--font-heading); font-size: 1.3rem; color: var(--text); }
    .resource .meta{font-size:0.9rem;color:var(--muted); font-family: var(--font-body);}
    .resource .actions{display:flex;gap:8px;margin-top:auto; padding-top: 8px; border-top: 1px dashed var(--border);}

    /* Docs List */
    .doc-list{display:flex;flex-direction:column;gap:8px}
    .doc-item{
        padding:12px; border-radius:var(--radius-sm); border:1px solid var(--border);
        display:flex; justify-content:space-between; align-items:center; transition: background 0.2s;
    }
    .doc-item:hover { background: var(--glass-bg); border-color: var(--accent); }
    .doc-item strong { font-family: var(--font-heading); font-size: 1.3rem; color: var(--text); }
    .doc-item .meta { font-family: var(--font-body); }

    /* Video Row */
    #video-row { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-top: 12px; }
    #video-row > div {
        background: var(--card); padding: 12px; border-radius: 10px; border: 1px solid var(--border);
        box-shadow: 0 4px 10px rgba(0,0,0,0.03);
    }

    /* Nút chính */
    .btn{
        background: var(--primary); color: #fff;
        padding: 10px 20px; border-radius: 8px; border:0;
        font-weight: 600; cursor:pointer; transition: all 0.25s ease-out;
        display: inline-flex; align-items: center; gap: 8px; font-size: 0.95rem;
        box-shadow: 0 4px 10px rgba(var(--primary-rgb, 161, 33, 38), 0.15); text-transform: uppercase; letter-spacing: 0.5px;
        font-family: var(--font-body);
    }
    .btn:hover { transform: translateY(-3px); filter: brightness(1.1); box-shadow: 0 8px 20px rgba(var(--primary-rgb, 161, 33, 38), 0.25); }
    [data-theme="dark"] .btn { color: var(--bg-dark); box-shadow: 0 5px 15px rgba(var(--primary-rgb, 180, 140, 71), 0.2); }
    [data-theme="dark"] .btn:hover { box-shadow: 0 8px 25px rgba(var(--primary-rgb, 180, 140, 71), 0.35); }

    /* Lightbox & Modal - Sử dụng CSS của vanhoa.html */
    .lightbox{position:fixed;inset:0;background:rgba(18, 18, 16, 0.95);display:flex;align-items:center;justify-content:center;z-index:9999;padding:20px; cursor: pointer;}
    .lightbox img{max-width:95%;max-height:95%;border-radius:var(--radius-sm); border: 5px solid var(--card); box-shadow: 0 20px 60px rgba(0,0,0,0.6);}
    .modal{position:fixed;inset:0;background:rgba(26, 24, 22, 0.9); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); display:flex;align-items:center;justify-content:center;z-index:999;display:none; padding: 24px;}
    .modal-card{
        background:var(--card); padding: 32px; border-radius:var(--radius);
        max-width:800px; width:95%; max-height:88vh; overflow-y:auto;
        border: 1px solid var(--border); box-shadow: var(--shadow-dark);
        font-family: var(--font-body);
    }
    .close-btn{background:transparent;border:0;font-size:32px;cursor:pointer; color: var(--muted); line-height: 1; padding: 0; transition: color 0.2s, transform 0.2s;}
    .close-btn:hover { color: var(--primary); transform: rotate(90deg); }
    .modal-header { display:flex;justify-content:space-between;align-items:flex-start;gap:16px; margin-bottom: 24px; padding-bottom: 20px; border-bottom: 1px solid var(--border); }
    .modal-header h3 { margin: 0; font-family: var(--font-heading); font-size: 2.5rem; color: var(--primary); line-height: 1.25; }
    .modal-content-area img { max-width: 100%; height: auto; border-radius: var(--radius-sm); margin-bottom: 16px; border: 1px solid var(--border); }


    /* Responsive */
    @media (max-width: 1000px){
      .wrap{padding: 0 24px;}
      .grid{grid-template-columns:repeat(2,1fr)}
      #video-row{grid-template-columns:1fr}
      .main-navigation { display: none; }
      #mobile-menu-toggle { display: flex !important; }
    }
    @media (max-width: 640px){
      .wrap{padding: 0 16px;}
      .grid{grid-template-columns:1fr}
      .search{width:100%; flex-direction: column;}
      .toolbar{flex-direction: column; align-items: stretch;}
      .filters{justify-content: center;}
      .header-container { flex-direction: row; }
      .sticky-header { height: 64px; }
      body { padding-top: 64px; --header-height: 64px; }
      h1.page-title { font-size: 2rem; }
      .modal-card { padding: 20px; }
      .modal-header h3 { font-size: 1.6rem; }
      .resource img{height: 160px;}
    }
     .hidden { display: none !important; }
/* === START: CSS Footer === */
    footer {
        margin-top: 64px;
        padding: 48px 0;
        background: var(--input-bg); /* Nền nhẹ cho footer */
        border-top: 1px solid var(--border);
        color: var(--muted);
        font-size: 0.95rem;
    }
    .footer-content {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        gap: 32px;
        max-width: var(--maxw); /* Sử dụng biến --maxw đã định nghĩa */
        margin: 0 auto;
        padding: 0 40px; /* Padding ngang khớp với .wrap */
        text-align: left;
    }
    .footer-column {
        flex: 1;
        min-width: 200px; /* Đảm bảo các cột không quá hẹp */
    }
    .footer-column h4 {
        font-family: var(--font-heading); /* Sử dụng font heading đã định nghĩa */
        font-size: 1.5rem;
        color: var(--text);
        margin: 0 0 16px 0;
        font-weight: 600;
    }
    .footer-column p, .footer-column a {
        color: var(--muted);
        text-decoration: none;
        display: block;
        margin-bottom: 10px;
        line-height: 1.6; /* Thêm line-height cho dễ đọc */
    }
    .footer-column a:hover {
        color: var(--primary); /* Sử dụng màu primary đã định nghĩa */
    }
    .footer-copyright {
        text-align: center;
        margin-top: 48px;
        padding-top: 24px;
        border-top: 1px dashed var(--border);
        font-size: 0.9rem;
    }
     /* Responsive cho footer */
    @media (max-width: 1024px) {
        .footer-content { padding: 0 24px; } /* Khớp padding wrap ở tablet */
    }
    @media (max-width: 768px) {
        .footer-content {
            flex-direction: column; /* Xếp chồng cột trên mobile */
            padding: 0 16px; /* Khớp padding wrap ở mobile nhỏ */
        }
    }
    @media (max-width: 480px) {
        .footer-content { padding: 0 12px; } /* Khớp padding wrap ở mobile rất nhỏ */
    }
    /* === END: CSS Footer === */
    /* === CSS Nút Chọn Ngôn Ngữ === */
.language-switcher {
    display: inline-flex; /* Dùng flex để căn chỉnh tốt hơn */
    align-items: center; /* Căn giữa theo chiều dọc */
    margin-left: 16px; /* Khoảng cách với phần tử trước đó */
    font-size: 0.85rem; /* Cỡ chữ nhỏ hơn một chút */
    color: var(--muted);
    border: 1px solid var(--border); /* Thêm viền nhẹ */
    border-radius: 99px; /* Bo tròn */
    padding: 2px; /* Khoảng đệm nhỏ bên trong */
    background-color: var(--input-bg); /* Nền nhẹ */
}
.lang-btn {
    background: none;
    border: none;
    padding: 4px 10px; /* Padding nút */
    cursor: pointer;
    font-weight: 500; /* Bỏ đậm mặc định */
    color: var(--muted);
    transition: all 0.2s ease-in-out;
    border-radius: 99px; /* Bo tròn nút */
    line-height: 1; /* Đảm bảo chiều cao nhất quán */
}
.lang-btn:hover {
    color: var(--primary);
    background-color: var(--glass-bg); /* Hiệu ứng kính khi hover */
}
.lang-btn.active {
    color: #fff; /* Chữ trắng khi active */
    font-weight: 600; /* Đậm hơn khi active */
    background-color: var(--primary); /* Nền màu chính khi active */
    box-shadow: 0 2px 8px rgba(var(--primary-rgb), 0.3); /* Đổ bóng nhẹ */
}
/* Thêm màu cho dấu | */
.language-switcher span {
    padding: 0 2px;
    color: var(--border);
}
/* === END CSS Nút Chọn Ngôn Ngữ === */
  </style>
</head>
<body>
   <div class="main-layout">
    <header class="sticky-header">
         <a href="trangchu.html" class="header-brand logo-image-mode" title="Dòng Chảy Lịch Sử Việt - Trang Chủ">
  <img src="images/dclsv.png" alt="Logo website" width="196" style="padding-top: 25px;"> </a>
            <nav class="main-navigation" aria-label="Điều hướng chính">
                 <ul>
                    <li><a href="trangchu.html">Trang Chủ</a></li>
                    <li><a href="lichsu.html">Lịch Sử</a></li>
                    <li><a href="dungnuocvagiunuoc.html" >Dựng Nước & Giữ Nước</a></li>
                    <li><a href="vanhoa.html">Văn Hóa</a></li>
                    <li><a href="khotulieu.html" class="active-page">Tư Liệu</a></li>
                    <li><a href="tintuc.html">Tin Tức</a></li>
                    <li><a href="lienhe.html">Liên Hệ & Góp ý</a></li>
                 </ul>
            </nav>
            <div class="header-actions">
                 <div class="language-switcher">
    <button id="lang-vi" class="lang-btn" data-lang="vi" data-translate-key="langVIE">VIE</button> |
    <button id="lang-en" class="lang-btn" data-lang="en" data-translate-key="langENG">ENG</button>
</div>
                 <button id="theme-toggle" class="icon-btn" title="Chuyển giao diện Sáng/Tối" aria-live="polite">
                 
                     <span class="theme-icon-light" aria-label="Chế độ sáng">☀️</span>
                     <span class="theme-icon-dark hidden" aria-label="Chế độ tối">🌙</span>
                 </button>
                  
            </div>
        
    </header>
  <div class="wrap">
    <div class="page-title-area">
        <h1 class="page-title">Kho Tư Liệu</h1>
        <p class="page-subtitle">Hình ảnh • Bản đồ • Tài liệu tham khảo • Video minh họa</p>
    </div>
    <main class="card" role="main">
      <div class="toolbar" aria-label="Công cụ tìm kiếm và bộ lọc">
        <div class="search" role="search">
          <input id="q" type="search" placeholder="Tìm theo tiêu đề, mô tả..." aria-label="Tìm tài liệu">
          <button id="clear-q" class="icon-btn" title="Xóa">✕</button>
        </div>

        <div class="filters" role="toolbar" aria-label="Bộ lọc loại">
          <button class="filter-btn active" data-type="all">Tất cả</button>
          <button class="filter-btn" data-type="image">Ảnh</button>
          <button class="filter-btn" data-type="map">Bản đồ</button>
          <button class="filter-btn" data-type="doc">Tài liệu</button>
          <button class="filter-btn" data-type="video">Video</button>

          <button id="add-resource" class="btn">+ Thêm tài liệu</button>
         
            <button id="export-json" class="icon-btn" title="Xuất JSON">⤓ Xuất</button>
            <input id="import-file" type="file" accept="application/json" style="display:none">
            <button id="import-json" class="icon-btn" title="Nhập JSON">⤴ Nhập</button>
       
        
      </div>

      <div id="results-area">
        <div class="grid" id="grid"></div>

        <div id="docs" style="margin-top:12px;display:none">
          <h3>Tài liệu (danh sách)</h3>
          <div class="doc-list" id="doc-list"></div>
        </div>

        <div id="empty" class="empty" style="display:none">Không tìm thấy tài nguyên phù hợp.</div>
      </div>

      <hr style="margin:18px 0; border-color: var(--border);"/>

      <section>
        <h3 style="font-family: var(--font-heading); font-size: 1.8rem; color: var(--text);">Video minh họa</h3>
        <div id="video-row">
          </div>
      </section>
    </main>
  </div>

  <div id="modal" class="modal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="modal-title">
      <div class="modal-header">
        <h3 id="modal-title">Thêm tài nguyên mới</h3>
        <button id="modal-close" class="close-btn" aria-label="Đóng">✕</button>
      </div>

      <form id="resource-form" style="margin-top:12px;display:grid;gap:10px">
        <label>Loại
          <select id="res-type" required>
            <option value="image">Ảnh</option>
            <option value="map">Bản đồ (link)</option>
            <option value="doc">Tài liệu (PDF/Link)</option>
            <option value="video">Video (YouTube URL)</option>
          </select>
        </label>

        <label>Tiêu đề <input id="res-title" required placeholder="Ví dụ: Bản đồ cổ TQ - 18xx"></label>
        <label>Mô tả <input id="res-desc" placeholder="Mô tả ngắn"></label>
        <label>URL (ảnh / link / pdf / youtube) <input id="res-url" required placeholder="https://..."></label>
        <div style="display:flex;gap:8px;justify-content:flex-end; margin-top: 10px;">
          <button type="button" id="modal-cancel" class="icon-btn">Hủy</button>
          <button type="submit" class="btn">Lưu</button>
        </div>
      </form>
    </div>
  </div>

  <div id="lightbox" style="display:none"></div>

  <script>
    (function(){
      // Sample starter dataset (paraphrased / placeholder)
      const SAMPLE = 
       [
  // images
  { id:'img1', type:'image', title:'Bản đồ cổ - Toàn cảnh', desc:'Bản đồ mô tả lãnh thổ (mẫu)', url:'https://iotlink.com.vn/wp-content/uploads/2023/12/ban-do-dong-an-do-181223-01.jpg', tags:['map','archive']},
  { id:'img2', type:'image', title:'Trống đồng Đông Sơn', desc:'Hình ảnh trống đồng (mẫu)', url:'https://belux.com.vn/Files/239/download/tu-van-qua-tang/49e52a298290aed5aa6d09e1a9eb6e77.jpg', tags:['artifact']},
  { id:'img3', type:'image', title:'Lễ hội truyền thống', desc:'Ảnh lễ hội (mẫu)', url:'https://static.vinwonders.com/2023/01/cac-le-hoi-o-viet-nam-2.jpg', tags:['festival']},

  // maps (external map link or static image)
  { id:'map1', type:'map', title:'Bản đồ Hà Nội (cổ)', desc:'Link bản đồ tham khảo', url:'https://vcdn1-vnexpress.vnecdn.net/2019/10/02/1942-1570001559.jpg?w=460&h=0&q=100&dpr=1&fit=crop&s=HnldY5byoX8FpypA_ivI8g', tags:['map']},

  // docs (link to pdf or page)
  { id:'doc1', type:'doc', title:'Tài liệu tham khảo: Lịch sử (mẫu)', desc:'PDF tham khảo (mẫu)', url:'https://www.youtube.com/watch?v=cxiwWoHk3p8', tags:['ref']},

  // videos (YouTube)
  { 
    id:'vid1', 
    type:'video', 
    title:'Video tư liệu: Khảo cổ', 
    desc:'Tìm hiểu về khảo cổ học Việt Nam – truyền hình Quốc hội Việt Nam', 
    url:'https://www.youtube.com/watch?v=zaT4b0QQvR4',  // từ kết quả turn0search0
    tags:['video']
  },
  { 
    id:'vid2', 
    type:'video', 
    title:'Phóng sự lịch sử: Phát hiện khảo cổ mới', 
    desc:'Phóng sự về phát hiện mới về khảo cổ ở Việt Nam', 
    url:'https://www.youtube.com/watch?v=f07E8S9XGcE',  // từ kết quả turn0search4
    tags:['video','archive']
  }];


      // DOM
      const htmlEl = document.documentElement;
      const qEl = document.getElementById('q');
      const clearQ = document.getElementById('clear-q');
      const filterBtns = document.querySelectorAll('.filter-btn');
      const grid = document.getElementById('grid');
      const docList = document.getElementById('doc-list');
      const docsSection = document.getElementById('docs');
      const emptyEl = document.getElementById('empty');
      const videoRow = document.getElementById('video-row');

      const modal = document.getElementById('modal');
      const modalClose = document.getElementById('modal-close');
      const addBtn = document.getElementById('add-resource');
      const resourceForm = document.getElementById('resource-form');
      const resType = document.getElementById('res-type');
      const resTitle = document.getElementById('res-title');
      const resDesc = document.getElementById('res-desc');
      const resUrl = document.getElementById('res-url');
      const modalCancel = document.getElementById('modal-cancel');

      const lightbox = document.getElementById('lightbox');
      const lightboxImg = lightbox.querySelector('img');
      const lightboxCloseBtn = lightbox.querySelector('button');

      const exportBtn = document.getElementById('export-json');
      const importBtn = document.getElementById('import-json');
      const importFile = document.getElementById('import-file');

      const themeToggleBtn = document.getElementById('theme-toggle');
      const themeIconLight = themeToggleBtn.querySelector('.theme-icon-light');
      const themeIconDark = themeToggleBtn.querySelector('.theme-icon-dark');
      const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
      const mobileNavOverlay = document.getElementById('mobile-nav-overlay');
      const mobileNavClose = document.getElementById('mobile-nav-close');


      // storage key
      const STORAGE_KEY = 'dcl_khotulu_v1';
      const THEME_STORAGE_KEY = 'dcl_theme_v5'; // Key mới

      // load items from localStorage or use sample
      function loadItems(){
        try{
          const s = localStorage.getItem(STORAGE_KEY);
          if(s) return JSON.parse(s);
        }catch(e){}
        // deep clone sample with unique ids if needed
        return SAMPLE.slice();
      }
      function saveItems(items){
        localStorage.setItem(STORAGE_KEY, JSON.stringify(items));
      }

      let ITEMS = loadItems();

      // helpers
      function uid(prefix='id'){ return prefix + Math.random().toString(36).slice(2,9); }
      function isYouTube(url){
        return /youtube\.com|youtu\.be/.test(url);
      }
      function youTubeEmbed(url){
        // accept youtube watch?v=... or youtu.be/... -> return embed src
        try{
          const u = new URL(url);
          if(u.hostname.includes('youtu.be')){
            return 'https://www.youtube.com/embed/' + u.pathname.slice(1);
          }
          if(u.hostname.includes('youtube.com')){
            const v = u.searchParams.get('v');
            if(v) return 'https://www.youtube.com/embed/' + v;
          }
        }catch(e){}
        return null;
      }

      // render grid (images / maps / videos as cards) and doc list
      function render(type='all', q=''){
        const query = (q||'').trim().toLowerCase();
        const filtered = ITEMS.filter(it => {
          if(type !== 'all' && it.type !== type) return false;
          if(!query) return true;
          return (it.title + ' ' + (it.desc||'') + ' ' + (it.tags||[]).join(' ')).toLowerCase().includes(query);
        });

        const bookmarks = getBookmarks(); // Lấy bookmarks

        // show/hide docs section depending on type
        const showDocs = (type === 'all' || type === 'doc');
        docsSection.style.display = showDocs ? 'block' : 'none';

        // grid: only show images/maps/videos (but keep doc as list)
        grid.innerHTML = '';
        const visualTypes = ['image','map','video'];
        const gridItems = filtered.filter(it=> visualTypes.includes(it.type));
        if(gridItems.length === 0) {
          grid.style.display = 'none';
        } else {
          grid.style.display = 'grid';
          gridItems.forEach(it=>{
            const isBookmarked = bookmarks.includes(it.id);
            const el = document.createElement('div');
            el.className = 'resource';
            let inner = '';
            if(it.type === 'image'){
              inner += `<img loading="lazy" src="${it.url}" alt="${it.title}" class="btn-view" data-id="${it.id}">`;
            } else if(it.type === 'map'){
              inner += `<div style="height:180px;border-radius:6px;overflow:hidden;background:linear-gradient(90deg, var(--primary)10%, var(--accent)90%);display:flex;align-items:center;justify-content:center;"><a href="${it.url}" target="_blank" rel="noopener" style="color:var(--card);text-decoration:none; font-family: var(--font-body); font-weight: 600;">Mở bản đồ →</a></div>`;
            } else if(it.type === 'video'){
              const embed = youTubeEmbed(it.url);
              if(embed){
                const thumb = 'https://img.youtube.com/vi/' + embed.split('/').pop() + '/hqdefault.jpg';
                inner += `<img loading="lazy" src="${thumb}" alt="${it.title}" class="btn-view" data-id="${it.id}">`;
              } else {
                inner += `<div style="height:180px;border-radius:6px;overflow:hidden;background:linear-gradient(90deg, var(--card), var(--glass-bg));display:flex;align-items:center;justify-content:center;"><span class="muted" style="font-family: var(--font-body);">Video (link)</span></div>`;
              }
            }
            inner += `<div><strong>${it.title}</strong><div class="meta">${it.type} • ${it.desc || ''}</div></div>`;
            inner += `<div class="actions">
                        <button class="btn btn-view" data-id="${it.id}">Xem</button>
                        <button class="icon-btn btn-save" data-id="${it.id}" title="${isBookmarked ? 'Bỏ lưu' : 'Lưu mục này'}" aria-pressed="${isBookmarked}">
                            ${isBookmarked ? '✓' : '★'}
                        </button>
                        <a class="icon-btn" href="${it.url}" target="_blank" rel="noopener" title="Mở trong tab mới">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>
                        </a>
                      </div>`;
            el.innerHTML = inner;
            grid.appendChild(el);
          });
        }

        // doc list
        docList.innerHTML = '';
        const docItems = filtered.filter(it=> it.type === 'doc');
        if(docItems.length === 0){
          docList.innerHTML = '<div class="muted" style="padding: 12px 0;">Không có tài liệu.</div>';
        } else {
          docItems.forEach(it=>{
            const isBookmarked = bookmarks.includes(it.id);
            const row = document.createElement('div');
            row.className = 'doc-item';
            row.innerHTML = `<div><strong>${it.title}</strong><div class="meta">${it.desc || ''}</div></div>
              <div style="display:flex;gap:8px;align-items:center">
                <button class="btn btn-view" data-id="${it.id}">Xem</button>
                <button class="icon-btn btn-save" data-id="${it.id}" title="${isBookmarked ? 'Bỏ lưu' : 'Lưu mục này'}" aria-pressed="${isBookmarked}">
                    ${isBookmarked ? '✓' : '★'}
                </button>
                <a class="icon-btn" href="${it.url}" target="_blank" rel="noopener" title="Mở trong tab mới">
                     <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>
                </a>
              </div>`;
            docList.appendChild(row);
          });
        }

        // video row (for all or when type=video)
        videoRow.innerHTML = '';
        const videoItems = filtered.filter(it=> it.type === 'video');
        videoItems.forEach(it=>{
          const c = document.createElement('div');
          const embed = youTubeEmbed(it.url);
          if(embed){
            c.innerHTML = `<iframe width="100%" height="240" src="${embed}" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen title="${it.title}"></iframe><div class="meta" style="margin-top:8px"><strong>${it.title}</strong><div class="muted">${it.desc||''}</div></div>`;
          } else {
            c.innerHTML = `<div class="muted" style="padding: 20px; text-align: center;">Không thể nhúng video (link không phải YouTube)</div><div style="margin-top:8px; padding: 0 10px 10px;"><strong>${it.title}</strong></div>`;
          }
          videoRow.appendChild(c);
        });

        // empty state
        const anyResult = gridItems.length + docItems.length;
        emptyEl.style.display = anyResult ? 'none' : 'block';
      }

      // --- Lightbox & Modal Functions (Đã tích hợp vào logic) ---
      function openLightbox(src){
        lightboxImg.src = src; lightbox.style.display = 'flex'; document.body.style.overflow = 'hidden'; lightbox.focus();
      }
      function closeLightbox() {
         lightbox.style.display = 'none'; if (modal.style.display !== 'flex') { document.body.style.overflow = ''; }
      }
      function openModal(html, title='Chi tiết', id=null){
        const modalCard = document.querySelector('.modal-card');
        modalCard.querySelector('#modal-title').textContent = title;
        let body = modalCard.querySelector('.modal-content-area');
        if (!body) {
          body = document.createElement('div');
          body.className = 'modal-content-area';
          modalCard.insertBefore(body, modalCard.querySelector('.modal-footer'));
        }
        body.style.marginTop = '12px';
        body.innerHTML = html;
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
        modal.setAttribute('aria-hidden','false');
        modalCard.scrollTop = 0; // Đảm bảo cuộn lên đầu

        const modalFooter = modalCard.querySelector('.modal-footer');
        const modalBookmarkBtn = modalFooter.querySelector('#modal-bookmark');
        if (id) {
            const bms = getBookmarks();
            const isBookmarked = bms.includes(id);
            modalBookmarkBtn.innerHTML = isBookmarked ? '✓ Bỏ lưu' : '★ Lưu';
            modalBookmarkBtn.setAttribute('data-id', id);
            modalBookmarkBtn.setAttribute('title', isBookmarked ? 'Bỏ lưu mục này' : 'Lưu mục này');
            modalBookmarkBtn.setAttribute('aria-pressed', isBookmarked);
            modalBookmarkBtn.style.display = '';
        } else {
            modalBookmarkBtn.style.display = 'none';
        }
      }
      function closeModal(){
        modal.style.display='none'; document.body.style.overflow = ''; modal.setAttribute('aria-hidden','true');
      }

      // open item (modal or lightbox)
      function openItem(id){
        const it = ITEMS.find(x=> x.id === id);
        if(!it) return alert('Không tìm thấy tài nguyên.');
        
        let htmlContent = `<p style="font-size: 0.95rem; color: var(--muted); margin-bottom: 12px;">Loại: ${it.type.charAt(0).toUpperCase() + it.type.slice(1)}</p>`;
        
        if(it.type === 'image'){
          openLightbox(it.url); return;
        } else if(it.type === 'map'){
          // open in new tab (maps usually require full window)
          window.open(it.url, '_blank'); return;
        } else if(it.type === 'doc'){
          if(/\.(pdf)(\?|$)/i.test(it.url)){
            htmlContent += `<iframe src="${it.url}" style="width:100%;height:70vh;border:1px solid var(--border);border-radius:var(--radius-sm); margin-bottom: 16px;"></iframe>`;
          } else {
            htmlContent += `<p class="muted">${it.desc || ''}</p><p><a href="${it.url}" target="_blank" rel="noopener" style="font-weight: 600;">Mở tài liệu →</a></p>`;
          }
        } else if(it.type === 'video'){
          const embed = youTubeEmbed(it.url);
          if(embed){
            htmlContent += `<iframe width="100%" height="400" src="${embed}" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen style="border-radius: var(--radius-sm); margin-bottom: 16px;"></iframe>`;
          } else {
            htmlContent += `<p class="muted">Không thể nhúng video.</p><p><a href="${it.url}" target="_blank" style="font-weight: 600;">Mở video →</a></p>`;
          }
        }
        
        htmlContent += `<p class="muted" style="margin-top: 16px;">${it.desc || 'Không có mô tả chi tiết.'}</p>`;
        
        openModal(htmlContent, it.title, id);
      }

      // bookmarks simple
      const BOOKMARK_KEY = STORAGE_KEY + '_bks';
      function getBookmarks(){ try{ return JSON.parse(localStorage.getItem(BOOKMARK_KEY)||'[]'); }catch(e){ return []; } }
      function saveBookmarks(list){ localStorage.setItem(BOOKMARK_KEY, JSON.stringify(list)); }
      function toggleBookmark(id){
        let b = getBookmarks();
        const isBookmarked = b.includes(id);
        if(isBookmarked) b = b.filter(x=>x!==id);
        else b.push(id);
        saveBookmarks(b);
        alert(b.includes(id) ? 'Đã lưu vào mục yêu thích' : 'Đã bỏ lưu');
        // Cập nhật lại giao diện
        render(document.querySelector('.filter-btn.active').getAttribute('data-type'), qEl.value);
      }
      
      // Initialize
      render('all','');

      // --- Event Listeners ---
      qEl.addEventListener('input', ()=> {
        const active = document.querySelector('.filter-btn.active');
        const type = active ? active.getAttribute('data-type') : 'all';
        render(type, qEl.value);
      });
      clearQ.addEventListener('click', ()=> { qEl.value=''; qEl.focus(); render('all',''); });

      filterBtns.forEach(btn=>{
        btn.addEventListener('click', ()=> {
          filterBtns.forEach(b=>b.classList.remove('active'));
          btn.classList.add('active');
          const type = btn.getAttribute('data-type');
          render(type, qEl.value);
        });
      });

      // view / save buttons (delegation)
      document.addEventListener('click', (e)=>{
        const v = e.target;
        const view = v.closest('.btn-view');
        const save = v.closest('.btn-save');
        const lightboxClick = v.closest('#lightbox');
        const modalBookmarkBtn = v.closest('#modal-bookmark');
        
        if(view){
          e.preventDefault();
          const id = view.getAttribute('data-id');
          openItem(id);
        }
        if(save){
          const id = save.getAttribute('data-id');
          toggleBookmark(id);
          // Cập nhật nút trong modal nếu đang mở
          if (modal.style.display === 'flex' && modalBookmarkBtn && modalBookmarkBtn.getAttribute('data-id') === id) {
             const bms = getBookmarks();
             const isBookmarked = bms.includes(id);
             modalBookmarkBtn.innerHTML = isBookmarked ? '✓ Bỏ lưu' : '★ Lưu';
             modalBookmarkBtn.setAttribute('title', isBookmarked ? 'Bỏ lưu mục này' : 'Lưu mục này');
             modalBookmarkBtn.setAttribute('aria-pressed', isBookmarked);
          }
        }
        if (lightboxClick === lightbox) { closeLightbox(); }
        if (v.closest('#lightbox button') === lightboxCloseBtn) { closeLightbox(); }
        if (v.closest('#modal-close') || v === modal) { closeModal(); }
      });

      document.addEventListener('keydown', (e)=> { if(e.key === 'Escape'){ closeModal(); closeLightbox(); closeMobileNav(); } });
      
      // add resource modal
      addBtn.addEventListener('click', ()=> {
        openModal(
            `<form id="resource-form-inside" style="margin-top:12px;display:grid;gap:10px">
                <label>Loại
                  <select id="res-type-inside" required style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid var(--border); background: var(--input-bg);">
                    <option value="image">Ảnh</option>
                    <option value="map">Bản đồ (link)</option>
                    <option value="doc">Tài liệu (PDF/Link)</option>
                    <option value="video">Video (YouTube URL)</option>
                  </select>
                </label>
                <label>Tiêu đề <input id="res-title-inside" required placeholder="Ví dụ: Bản đồ cổ TQ - 18xx" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid var(--border); background: var(--input-bg);"></label>
                <label>Mô tả <input id="res-desc-inside" placeholder="Mô tả ngắn" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid var(--border); background: var(--input-bg);"></label>
                <label>URL (ảnh / link / pdf / youtube) <input id="res-url-inside" required placeholder="https://..." style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid var(--border); background: var(--input-bg);"></label>
                <div style="display:flex;gap:8px;justify-content:flex-end; margin-top: 10px;">
                  <button type="button" id="modal-cancel-inside" class="icon-btn">Hủy</button>
                  <button type="submit" class="btn">Lưu</button>
                </div>
              </form>`,
            'Thêm Tài Nguyên Mới'
        );
        document.getElementById('modal-cancel-inside').addEventListener('click', closeModal);
        document.getElementById('resource-form-inside').addEventListener('submit', (e)=>{
             e.preventDefault();
             const item = {
               id: uid('res_'),
               type: document.getElementById('res-type-inside').value,
               title: document.getElementById('res-title-inside').value.trim(),
               desc: document.getElementById('res-desc-inside').value.trim(),
               url: document.getElementById('res-url-inside').value.trim(),
               tags: []
             };
             ITEMS.unshift(item); // newest first
             saveItems(ITEMS);
             render(document.querySelector('.filter-btn.active').getAttribute('data-type'), qEl.value);
             closeModal();
             alert('Đã thêm tài nguyên (lưu cục bộ trên trình duyệt).');
         });
      });
      

      // export/import JSON
      exportBtn.addEventListener('click', ()=>{
        const blob = new Blob([JSON.stringify(ITEMS, null, 2)], {type:'application/json'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'khotulu-export.json';
        a.click();
        setTimeout(()=> URL.revokeObjectURL(a.href), 5000);
      });
      importBtn.addEventListener('click', ()=> importFile.click());
      importFile.addEventListener('change', (e)=>{
        const f = e.target.files[0];
        if(!f) return;
        const reader = new FileReader();
        reader.onload = (ev)=>{
          try{
            const data = JSON.parse(ev.target.result);
            if(!Array.isArray(data)) throw new Error('Invalid format');
            ITEMS = data;
            saveItems(ITEMS);
            render('all','');
            alert('Nhập dữ liệu thành công.');
          }catch(err){
            alert('Không thể nhập file: ' + err.message);
          }
        };
        reader.readAsText(f);
      });

      // --- Theme Toggle Functionality ---
      function applyTheme(theme) {
          htmlEl.setAttribute('data-theme', theme);
          localStorage.setItem(THEME_STORAGE_KEY, theme);
          if (theme === 'dark') {
              themeIconLight.classList.add('hidden');
              themeIconDark.classList.remove('hidden');
          } else {
              themeIconLight.classList.remove('hidden');
              themeIconDark.classList.add('hidden');
          }
      }
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      const storedTheme = localStorage.getItem(THEME_STORAGE_KEY) || (prefersDark ? 'dark' : 'light');
      applyTheme(storedTheme);

      themeToggleBtn.addEventListener('click', ()=> {
        const newTheme = htmlEl.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
        applyTheme(newTheme);
      });

      // --- Mobile Menu Logic ---
       function openMobileNav() {
           mobileNavOverlay.style.display = 'flex';
           mobileNavOverlay.classList.remove('hidden');
           mobileNavOverlay.setAttribute('aria-hidden', 'false');
           mobileMenuToggle.setAttribute('aria-expanded', 'true');
           document.body.style.overflow = 'hidden';
           mobileNavClose.focus();
       }
       function closeMobileNav() {
           mobileNavOverlay.style.display = 'none';
           mobileNavOverlay.classList.add('hidden');
           mobileNavOverlay.setAttribute('aria-hidden', 'true');
           mobileMenuToggle.setAttribute('aria-expanded', 'false');
            if (modal.style.display !== 'flex' && lightbox.style.display !== 'flex') {
               document.body.style.overflow = '';
           }
       }

       mobileMenuToggle.addEventListener('click', openMobileNav);
       mobileNavClose.addEventListener('click', closeMobileNav);
       mobileNavOverlay.querySelectorAll('a').forEach(link => {
           link.addEventListener('click', closeMobileNav);
       });

      // helper: when page loads with ?q=... or ?type=..., apply
      (function applyQuery(){
        const params = new URLSearchParams(location.search);
        const q = params.get('q'); const type = params.get('type');
        if(q){ qEl.value = q; }
        if(type){
          const btn = Array.from(filterBtns).find(b=>b.getAttribute('data-type') === type);
          if(btn) btn.click();
        }
        render(document.querySelector('.filter-btn.active').getAttribute('data-type'), qEl.value);
      })();

    })();
  </script>
  <footer>
      <div class="footer-content">
          <div class="footer-column">
              <h4>Giới thiệu</h4>
              <p>Trang web "Dòng Chảy Lịch Sử" cung cấp thông tin tóm tắt về lịch sử Việt Nam qua các thời kỳ, phục vụ mục đích tham khảo và học tập.</p>
          </div>
          <div class="footer-column">
              <h4>Liên hệ</h4>
              <a href="mailto:info@lichsuviet.vn">Email: info@lichsuviet.vn</a>
              <a href="tel:+84123456789">Điện thoại: (012) 345-6789</a>
              <p>Địa chỉ: 123 Đường ABC, Hà Nội</p>
          </div>
          <div class="footer-column">
              <h4>Hỗ trợ</h4>
              <a href="faq.html">Câu hỏi thường gặp</a>
              <a href="lienhe.html">Góp ý nội dung</a>
              <a href="policy.html">Chính sách bảo mật</a>
          </div>
      </div>
 <div class="wrap"> <div class="footer-copyright">
                 <p class="muted" style="color: red; font-weight: bold; font-size: 20px; text-align: center;">
  🇻🇳 Hoàng Sa, Trường Sa là của Việt Nam 🇻🇳
</p>

                        <p class="muted">© Dòng Chảy Lịch Sử Việt . Made by Bùi Lê Hậu . Thông tin tổng hợp cho mục đích tham khảo.</p>
                        
                    </div>
                </div>
  </footer>
</body>
</html>