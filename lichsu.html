<!doctype html>
<html lang="vi" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dòng Chảy — Lịch sử Việt Nam (tóm tắt)</title>
  <meta name="description" content="Tổng quan lịch sử Việt Nam: tiền sử, cổ đại, Bắc thuộc, quân chủ, hiện đại — trình bày theo giai đoạn." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400;0,600;0,700;1,400&family=Inter:wght@300;400;500;600;700&family=Praise&display=swap" rel="stylesheet">
  <!-- Font thư pháp Á Đông -->
<link href="https://fonts.googleapis.com/css2?family=WindSong:wght@400;500&family=Great+Vibes&display=swap" rel="stylesheet">

  <style>
    :root {
      /* === Bảng màu Light Mode === */
      --bg-light: #fdfbf6; --card-light: #ffffff; --primary-light: #8C1C13; --accent-light: #B08D57;
      --text-light: #3a2e27; --muted-light: #7a6a5f; --border-light: #e0d8ce;
      --shadow-light: 0 15px 40px rgba(90, 70, 58, 0.12);
      --glass-light: rgba(253, 251, 246, 0.85); --input-bg-light: #f7f3ed;
      --pattern-light: url("data:image/svg+xml,%3Csvg width='80' height='80' viewBox='0 0 80 80' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23e0d8ce' fill-opacity='0.08'%3E%3Cpath d='M0 0h40v40H0zM40 40h40v40H40z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
      /* Thêm màu gốc cho TOC */
      --toc-primary-original: #C8102E;
      --toc-accent-original: #D4AF37;
      --toc-muted2-original: #7a665b;


      /* === Bảng màu Dark Mode === */
      --bg-dark: #141210; --card-dark: #1f1d1b; --primary-dark: var(--accent-light); --accent-dark: #cea86a;
      --text-dark: #f0e6d8; --muted-dark: #a89f94; --border-dark: #4a443e;
      --shadow-dark: 0 18px 55px rgba(0, 0, 0, 0.45);
      --glass-dark: rgba(20, 18, 16, 0.85); --input-bg-dark: #2c2926;
      --pattern-dark: url("data:image/svg+xml,%3Csvg width='80' height='80' viewBox='0 0 80 80' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%234a443e' fill-opacity='0.1'%3E%3Cpath d='M0 0h40v40H0zM40 40h40v40H40z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");

      /* === Thiết lập ban đầu (Light) === */
      --bg: var(--bg-light); --card: var(--card-light); --primary: var(--primary-light); --accent: var(--accent-light);
      --text: var(--text-light); --muted: var(--muted-light); --border: var(--border-light); --shadow: var(--shadow-light);
      --glass-bg: var(--glass-light); --input-bg: var(--input-bg-light); --pattern: var(--pattern-light);

      --radius: 14px; --radius-sm: 8px; --maxw: 1100px; --toc-header-height: 68px; --sidebar-width: 260px;

      /* Font Families */
      --font-body: 'Inter', system-ui, Arial, sans-serif;
      --font-heading: 'EB Garamond', serif;
      --font-display: 'Praise', cursive;
    }
    [data-theme="dark"]{
      --bg: var(--bg-dark); --card: var(--card-dark); --primary: var(--primary-dark); --accent: var(--accent-dark);
      --text: var(--text-dark); --muted: var(--muted-dark); --border: var(--border-dark); --shadow: var(--shadow-dark);
      --glass-bg: var(--glass-dark); --input-bg: var(--input-bg-dark); --pattern: var(--pattern-dark);
    }
    *, *::before, *::after { box-sizing: border-box; }
    html{ scroll-behavior:smooth; scroll-padding-top: calc(var(--toc-header-height) + 20px); }
    
    /* === ĐÃ SỬA LỖI STICKY (giữ nguyên từ lần trước) === */
    body{
        margin:0; padding: 0; font-family: var(--font-body); background-color: var(--bg);
        background-image: var(--pattern); color: var(--text); 
        font-size: 16px; line-height: 1.75; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
        padding-left: var(--sidebar-width);
        /* Đã thêm transition cho mượt mà */
        transition: background 0.3s, color 0.3s, padding-left 0.3s ease; 
    }
    a{color:var(--primary);text-decoration:none; transition: color 0.2s ease-out, opacity 0.2s ease-out;}
    a:hover { color: var(--accent); opacity: 0.9; }
    img { max-width: 100%; height: auto; display: block; border-radius: var(--radius-sm); }

    .wrap{max-width:var(--maxw); margin:0 auto; padding: 0 40px;}

    /* === Sidebar Trái === (Giữ nguyên) */
    .left-sidebar { position: fixed; top: 0; left: 0; width: var(--sidebar-width); height: 100vh; background: var(--card); border-right: 1px solid var(--border); padding: 32px 24px; z-index: 1001; display: flex; flex-direction: column; transition: background 0.3s, border 0.3s, transform 0.3s ease; overflow-y: auto; box-shadow: 10px 0 35px rgba(0,0,0,0.06); background-image: var(--pattern); background-blend-mode: overlay; }
    [data-theme="dark"] .left-sidebar { box-shadow: 10px 0 45px rgba(0,0,0,0.25); }
    .sidebar-logo { display: flex; align-items: center; gap: 14px; margin-bottom: 40px; color: var(--primary); padding-bottom: 24px; border-bottom: 1px dashed var(--border);}
    .logo-icon { width: 52px; height: 52px; border-radius: 12px; background: linear-gradient(145deg, var(--primary-light), #7a1519); color: #fff; font-weight: 700; font-size: 1.2rem; display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 20px rgba(140, 28, 19, 0.3); transition: transform 0.3s ease-out; }
    .sidebar-logo:hover .logo-icon { transform: rotate(-10deg) scale(1.05); }
    [data-theme="dark"] .logo-icon { background: linear-gradient(145deg, var(--accent-dark), var(--accent-light)); color: var(--bg-dark); box-shadow: 0 8px 25px rgba(180, 140, 71, 0.35); }
    .logo-text { font-family: var(--font-heading); font-size: 1.9rem; font-weight: 700; line-height: 1.1; }
    .main-nav h3 { font-size: 0.8rem; text-transform: uppercase; color: var(--muted); margin: 24px 0 12px 0; letter-spacing: 0.8px; font-weight: 600; }
    .main-nav a { display: flex; align-items: center; gap: 12px; padding: 14px 18px; margin-bottom: 6px; font-weight: 500; color: var(--text); border-radius: 8px; transition: background 0.2s, color 0.2s, transform 0.1s ease-out; font-size: 1rem; }
     .main-nav a svg { width: 18px; height: 18px; opacity: 0.6; transition: opacity 0.2s; }
    .main-nav a:hover { background: var(--glass); color: var(--primary); transform: translateX(4px); }
    .main-nav a:hover svg { opacity: 1; }
    .main-nav a.active-page { background: var(--primary); color: #fff; font-weight: 600; }
    .main-nav a.active-page svg { opacity: 1; }
    [data-theme="dark"] .main-nav a.active-page { color: var(--bg-dark); }
    .sidebar-footer { margin-top: auto; padding-top: 24px; border-top: 1px dashed var(--border); }
    #theme-toggle { width: 100%; justify-content: center; font-size: 0.9rem; gap: 8px; padding: 12px; } /* Style nút theme */
    #theme-toggle .theme-icon-dark, #theme-toggle .theme-icon-light { transition: opacity 0.3s, transform 0.3s; }
    #theme-toggle:hover .theme-icon-light { transform: rotate(15deg) scale(1.1); }
    #theme-toggle:hover .theme-icon-dark { transform: rotate(-10deg) scale(1.1); }
    .icon-btn{ background: transparent; border: 1px solid var(--border); padding: 12px; border-radius: 10px; color: var(--muted); cursor: pointer; transition: all 0.25s ease-out; line-height: 1; display: flex; align-items: center; justify-content: center; position: relative; }
    .icon-btn:hover { background: var(--glass); border-color: var(--primary); color: var(--primary); transform: translateY(-3px) scale(1.08); box-shadow: 0 6px 18px rgba(0,0,0,0.08);}
    .icon-btn svg { width: 20px; height: 20px; }


    /* === Header TOC Kính (Thuộc tính sticky sẽ hoạt động) === */
    .sticky-toc-header {
        position: sticky; top: 0; z-index: 999;
        background: var(--glass-bg); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px);
        border-bottom: 1px solid var(--border); transition: all 0.3s ease-out;
        height: var(--toc-header-height); display: flex; align-items: center;
        box-shadow: 0 3px 15px rgba(0,0,0,0.04);
    }
    [data-theme="dark"] .sticky-toc-header { box-shadow: 0 4px 20px rgba(0,0,0,0.2); }
    
    /* === TOC Nav (Khôi phục style gốc) === */
    nav.toc{
        display:flex; flex-wrap:nowrap; gap:8px; margin: 0; padding: 0 40px; /* Padding ngang khớp .wrap */
        width: 100%; overflow-x: auto; scrollbar-width: none;
        /* Style nền gốc */
        background:linear-gradient(90deg, rgba(var(--primary-rgb, 140, 28, 19),0.03), rgba(var(--accent-rgb, 176, 141, 87),0.01));
        border:1px solid rgba(0,0,0,0.03); /* Viền gốc rất nhẹ */
        padding-top: 12px; padding-bottom: 12px; /* Padding trên dưới */
        border-radius: 0; /* Bỏ bo góc nếu muốn sát viền */
    }
    nav.toc::-webkit-scrollbar { display: none; }
    nav.toc a{
        padding:8px 14px; /* Padding gốc */ border-radius:999px; /* Bo tròn */
        background:rgba(0,0,0,0.03); color:var(--toc-muted2-original, #7a665b); /* Màu muted gốc */
        font-weight:600; white-space:nowrap; transition:all .18s; font-size: 0.95rem;
        flex-shrink: 0; border: none; /* Bỏ border */ box-shadow: none; /* Bỏ shadow */
    }
    nav.toc a:hover{ transform:translateY(-3px); background:rgba(0,0,0,0.06); color: var(--primary); } /* Hover gốc */
    nav.toc a.active{
        background:linear-gradient(90deg, var(--toc-primary-original, #C8102E), #9e0b28); /* Gradient gốc */
        color:#fff !important; /* Quan trọng để ghi đè */
        box-shadow:0 12px 30px rgba(var(--primary-rgb),0.12); /* Shadow gốc */
        transform: translateY(-2px); /* Nhẹ nhàng hơn hover */
    }
    /* Dark Mode cho TOC gốc */
    [data-theme="dark"] nav.toc {
        background: transparent; border: 1px solid var(--border-dark);
    }
    [data-theme="dark"] nav.toc a {
        background: rgba(255,255,255,0.05); color: var(--muted-dark);
    }
    [data-theme="dark"] nav.toc a:hover {
        background: rgba(255,255,255,0.1); color: var(--primary-dark);
    }
    [data-theme="dark"] nav.toc a.active {
        background: linear-gradient(90deg, var(--primary-dark), var(--accent-dark)); /* Gradient dark */
        color: var(--bg-dark) !important; /* Chữ tối */
        box-shadow: 0 12px 30px rgba(var(--accent-rgb), 0.2);
    }

    /* === START: ĐÃ THÊM CSS cho Sidebar Toggle === */
    body.sidebar-hidden {
        padding-left: 0;
    }
    body.sidebar-hidden .left-sidebar {
        transform: translateX(-100%);
    }
    
    /* Thêm padding-left cho TOC để chừa chỗ cho nút Menu */
    .sticky-toc-header .toc {
        padding-left: 120px !important;
    }

    /* Ẩn nút toggle này trên mobile (khi sidebar gốc bị ẩn) */
    @media (max-width: 1250px) {
        #sidebar-toggle-button {
            display: none !important;
        }
        /* Trả lại padding gốc cho TOC trên mobile */
        .sticky-toc-header .toc, nav.toc {
             padding-left: 40px !important; 
        }
        @media (max-width: 768px) {
            .sticky-toc-header .toc, nav.toc { padding-left: 16px !important; padding-right: 16px !important;}
        }
        @media (max-width: 480px) {
            .sticky-toc-header .toc, nav.toc { padding-left: 12px !important; padding-right: 12px !important;}
        }
    }
    /* === END: CSS cho Sidebar Toggle === */

    /* Content Area */
    .content-area { padding: 80px 0; }

    /* Page Header */
    .page-header { margin-bottom: 72px; /* ... giữ nguyên ... */ }
    h1.page-title{ /* ... giữ nguyên ... */ }
    .page-subtitle{ /* ... giữ nguyên ... */ }

    /* Main Card */
    main.card{ background:var(--card); padding: 56px; border-radius:var(--radius); box-shadow:var(--shadow); border: 1px solid var(--border); transition: background 0.3s, border 0.3s; background-image: var(--pattern); background-size: 100px 100px; background-blend-mode: overlay; }

    /* Main Layout Grid */
    .layout{display:grid;grid-template-columns:minmax(0, 2.5fr) minmax(0, 1fr);gap:56px;align-items:start}

    /* Content Area */
    .content section{margin-bottom:56px; padding-bottom: 40px; border-bottom: 1px dashed var(--border);}
    .content section:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0;}
    .content h2{ margin:0 0 20px 0; font-family: var(--font-heading); color: var(--text); font-size: 2.5rem; font-weight: 700; line-height: 1.3; position: relative; padding-bottom: 12px; }
     .content h2::after { content: ''; position: absolute; bottom: 0; left: 0; width: 70px; height: 3px; background-color: var(--primary); border-radius: 1.5px; }
    .content h4 { font-family: var(--font-heading); font-size: 1.6rem; color: var(--primary); margin: 24px 0 10px 0; font-weight: 600; }
    .content p { margin-bottom: 1.3em; color: var(--muted); font-size: 1.05rem; line-height: 1.8;}
    .content ul { padding-left: 28px; margin: 20px 0; color: var(--muted); }
    .content li { margin-bottom: 12px; padding-left: 10px; position: relative; }
    .content li::before { content: '•'; position: absolute; left: -10px; top: 0px; color: var(--accent); font-size: 1.2em; }
    .content strong { color: var(--text); font-weight: 600;}
    .content .small { font-size: 0.95rem; color: var(--muted); margin-bottom: 16px; display: block; font-style: italic;}
    .content table { width:100%; border-collapse:collapse; margin-top:20px; font-size: 0.95rem; box-shadow: 0 4px 15px rgba(0,0,0,0.05); border-radius: var(--radius-sm); overflow: hidden; border: 1px solid var(--border);}
    .content th, .content td { text-align:left; padding: 14px 16px; border-bottom: 1px solid var(--border); }
    .content th { font-weight: 600; color: var(--text); background: var(--input-bg);}
    .content tr:last-child td { border-bottom: none; }
    .content tr:hover td { background-color: var(--glass); }

    /* Sidebar */
    aside.sidebar{position:relative}
    aside .sticky{position:sticky;top: calc(var(--toc-header-height) + 40px); padding: 0;}
    .aside-box{ background:var(--card); padding: 32px; border-radius:var(--radius); margin-bottom:32px; border: 1px solid var(--border); box-shadow: var(--shadow-light); position: relative; overflow: hidden; background-image: var(--pattern); background-size: 80px 80px; background-blend-mode: soft-light; }
     .aside-box > * { position: relative; z-index: 1; }
     .aside-box h3 { margin: 0 0 20px 0; font-family: var(--font-heading); font-size: 1.8rem; color: var(--text); padding-bottom: 12px; border-bottom: 1px solid var(--border); position: relative; font-weight: 600; }
     .aside-box h3::after { content: ''; position: absolute; bottom: -1px; left: 0; width: 60px; height: 3px; background-color: var(--primary); border-radius: 1.5px; }
    .banner-mini{background:linear-gradient(135deg, var(--primary), #7a1519);color:#fff;border-radius:var(--radius);padding:28px;text-align:center;margin-bottom:32px;box-shadow: 0 10px 30px rgba(var(--primary-rgb), 0.35);}
    .banner-mini h3{font-family:var(--font-heading);margin:0;font-size:2rem; font-weight: 700; line-height: 1.3;}
    .banner-mini p{margin:12px 0 0;font-size:1rem;opacity:0.9;}
    [data-theme="dark"] .banner-mini { background: linear-gradient(135deg, var(--accent), #9e7839); color: var(--bg-dark); box-shadow: 0 12px 35px rgba(var(--accent-rgb), 0.35);}
    .mini-tl{margin-top:24px;font-size:1rem;}
    .mini-tl strong { display: block; margin-bottom: 16px; font-weight: 600; color: var(--text); font-size: 1.1rem;}
    /* Mini Timeline */
    .timeline{margin-top:16px;display:flex;flex-direction:column;gap:16px; position: relative;}
     .timeline::before { content: ''; position: absolute; top: 10px; bottom: 10px; left: 21px; width: 2px; background: var(--border); z-index: 0;}
    .tl-item{ display:flex;align-items:center;gap:16px;padding: 14px 18px;border-radius:var(--radius-sm); background:var(--input-bg); border: 1px solid var(--border); cursor:pointer; transition:all .25s ease-out; z-index: 1; position: relative; }
    .tl-item:hover{transform:translateX(6px) scale(1.03); background: var(--card); border-color: var(--accent); box-shadow: 0 8px 20px rgba(0,0,0,0.1);}
    .tl-dot{width:44px;height:44px;border-radius:50%;display:flex;align-items:center;justify-content:center;flex:0 0 44px;background:linear-gradient(180deg,var(--primary),#7a1519);box-shadow:0 6px 15px rgba(var(--primary-rgb), 0.25); border: 3px solid var(--card);}
    .tl-dot span{width:12px;height:12px;border-radius:50%;background:#fff;display:block}
    [data-theme="dark"] .tl-dot { background: linear-gradient(180deg, var(--accent), #9e7839); box-shadow: 0 8px 20px rgba(var(--accent-rgb), 0.3); border-color: var(--card-dark);}
    .tl-text{flex:1}
    .tl-text .t{font-weight:600; color: var(--text); font-size: 1.05rem;}
    .tl-text .d{font-size:0.9rem;color:var(--muted); margin-top: 3px;}
    .tl-item.active-item { border-color: var(--primary); background: var(--card); transform: translateX(6px) scale(1.03); box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
    .tl-item.active-item .t { color: var(--primary); }

    /* === START: ĐÃ SỬA Footer (Giữ nguyên) === */
    footer {
        margin-top: 64px;
        padding: 48px 0;
        background: var(--input-bg); /* Cho footer một nền nhẹ */
        border-top: 1px solid var(--border);
        color: var(--muted);
        font-size: 0.95rem;
    }
    .footer-content {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        gap: 32px;
        max-width: var(--maxw);
        margin: 0 auto;
        padding: 0 40px;
        text-align: left;
    }
    .footer-column {
        flex: 1;
        min-width: 200px;
    }
    .footer-column h4 {
        font-family: var(--font-heading);
        font-size: 1.5rem;
        color: var(--text);
        margin: 0 0 16px 0;
        font-weight: 600;
    }
    .footer-column p, .footer-column a {
        color: var(--muted);
        text-decoration: none;
        display: block;
        margin-bottom: 10px;
    }
    .footer-column a:hover {
        color: var(--primary);
    }
    .footer-copyright {
        text-align: center;
        margin-top: 48px;
        padding-top: 24px;
        border-top: 1px dashed var(--border);
        font-size: 0.9rem;
    }
    /* Responsive cho footer mới */
    @media (max-width: 1024px) {
        .footer-content { padding: 0 24px; }
    }
    @media (max-width: 768px) {
        .footer-content {
            flex-direction: column;
            padding: 0 16px;
        }
    }
    @media (max-width: 480px) {
        .footer-content { padding: 0 12px; }
    }
    /* === END: ĐÃ SỬA Footer === */


    /* Responsive */
    @media (max-width: 1250px) { body { padding-left: 0; } .left-sidebar { transform: translateX(-100%); width: 0; padding: 0; border: none; box-shadow: none;} .content-wrapper { margin-left: 0; } .sticky-toc-header .wrap { max-width: none; } #mobile-menu-toggle { display: flex !important; } }
    @media (max-width: 1024px) { .wrap { padding: 0 24px; } .main-navigation { display: none; } .content-area { padding: 48px 0; } .layout{grid-template-columns:1fr} aside.sidebar { margin-top: 48px; } aside .sticky{ position: relative; top: unset; } h1.page-title { font-size: 5rem; } .page-subtitle { font-size: 1.15rem; } .content h2 { font-size: 2.2rem; } }

    /* Focus styles */
    *:focus-visible { outline: 3px solid var(--accent); outline-offset: 4px; border-radius: 6px; box-shadow: 0 0 0 6px rgba(var(--accent-rgb), 0.3); }
    :root { --accent-rgb: 180, 140, 71; } [data-theme="dark"] { --accent-rgb: 206, 168, 106; }
    *:focus:not(:focus-visible) { outline: none; }

    /* Helper class */
    .hidden { display: none !important; }

    /* Mobile Nav Overlay */
    .mobile-nav-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(var(--bg-rgb, 253, 251, 246), 0.97); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); z-index: 1001; display: none; flex-direction: column; align-items: center; justify-content: center; padding: 40px; animation: fadeIn 0.3s ease-out; }
    :root { --bg-rgb: 253, 251, 246; } [data-theme="dark"] { --bg-rgb: 20, 18, 16; }
    .mobile-nav-overlay nav { display: flex; flex-direction: column; align-items: center; gap: 20px; }
    .mobile-nav-overlay a { font-size: 1.8rem; font-weight: 600; color: var(--text); padding: 10px 20px; border-radius: 8px; font-family: var(--font-heading); }
    .mobile-nav-overlay a.active-page { color: var(--primary); }
    .mobile-nav-close { position: absolute; top: 20px; right: 20px; font-size: 2.5rem; background: none; border: none; color: var(--text); cursor: pointer; padding: 10px;}
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    /* === Font thư pháp cho tiêu đề === */
h1, h2, h3 {
   font-family: 'Great Vibes', 'WindSong', cursive !important;
  font-weight: 500;
  letter-spacing: 1px;
}

/* Làm h1 nổi bật hơn */
h1.page-title {
  font-size: 5rem;
  line-height: 1.2;
  color: var(--primary);
  text-shadow: 1px 2px 4px rgba(0,0,0,0.1);
}

/* H2 uyển chuyển nhưng vẫn đọc rõ */
h2 {
  font-size: 2.6rem;
  color: var(--primary);
  margin-bottom: 20px;
}

/* H3 tinh tế hơn */
h3 {
  font-size: 1.8rem;
  color: var(--accent);
}
/* === CSS Nút Chọn Ngôn Ngữ === */
.language-switcher {
    display: inline-flex; /* Dùng flex để căn chỉnh tốt hơn */
    align-items: center; /* Căn giữa theo chiều dọc */
    margin-left: 16px; /* Khoảng cách với phần tử trước đó */
    font-size: 0.85rem; /* Cỡ chữ nhỏ hơn một chút */
    color: var(--muted);
    border: 1px solid var(--border); /* Thêm viền nhẹ */
    border-radius: 99px; /* Bo tròn */
    padding: 2px; /* Khoảng đệm nhỏ bên trong */
    background-color: var(--input-bg); /* Nền nhẹ */
}
.lang-btn {
    background: none;
    border: none;
    padding: 4px 10px; /* Padding nút */
    cursor: pointer;
    font-weight: 500; /* Bỏ đậm mặc định */
    color: var(--muted);
    transition: all 0.2s ease-in-out;
    border-radius: 99px; /* Bo tròn nút */
    line-height: 1; /* Đảm bảo chiều cao nhất quán */
}
.lang-btn:hover {
    color: var(--primary);
    background-color: var(--glass-bg); /* Hiệu ứng kính khi hover */
}
.lang-btn.active {
    color: #fff; /* Chữ trắng khi active */
    font-weight: 600; /* Đậm hơn khi active */
    background-color: var(--primary); /* Nền màu chính khi active */
    box-shadow: 0 2px 8px rgba(var(--primary-rgb), 0.3); /* Đổ bóng nhẹ */
}
/* Thêm màu cho dấu | */
.language-switcher span {
    padding: 0 2px;
    color: var(--border);
}
/* === END CSS Nút Chọn Ngôn Ngữ === */
  </style>
</head>
<body class="sidebar-hidden">
  <nav class="left-sidebar" aria-label="Điều hướng chính" id="left-sidebar-nav">
    <a href="trangchu.html" class="header-brand logo-image-mode" title="Dòng Chảy Lịch Sử Việt - Trang Chủ">
  <img src="images/dclsv.png" alt="Logo website" width="400"> </a>
    <div class="main-nav">
      <a href="trangchu.html"> <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
        Trang Chủ
      </a>
      <a href="lichsu.html" class="active-page"> <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
        Lịch Sử
      </a>
    <a href="dungnuocvagiunuoc.html"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round"> <path d="M3 22v-8l9-4 9 4v8H3z"></path> <path d="M9 22v-6h6v6"></path> <path d="M9 8V3h6v5"></path>
  </svg>
  Dựng nước và giữ nước
</a>

      <a href="vanhoa.html"> <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
        Văn Hóa
      </a>
      <a href="khotulieu.html"> <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>
        Tư Liệu
      </a>
       <a href="tintuc.html"> <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg>
        Tin Tức
      </a>
      <a href="lienhe.html"> <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
        Liên Hệ & Góp ý
      </a>
     <div class="language-switcher">
    <button id="lang-vi" class="lang-btn" data-lang="vi" data-translate-key="langVIE">VIE</button> |
    <button id="lang-en" class="lang-btn" data-lang="en" data-translate-key="langENG">ENG</button>
</div>
    </div>
    <div class="sidebar-footer">
        
         <button id="theme-toggle" class="icon-btn" title="Chuyển giao diện Sáng/Tối" aria-live="polite">
            
             <span class="theme-icon-light" aria-label="Chế độ sáng">☀️ Sáng</span>
             <span class="theme-icon-dark hidden" aria-label="Chế độ tối">🌙 Tối</span>
         </button>
         
         </div>
          
  </nav>

  <div class="content-wrapper">
      
      <header class="sticky-toc-header">
            
            <button id="sidebar-toggle-button" 
                    style="position: absolute; left: 24px; top: 50%; transform: translateY(-50%); z-index: 10;
                           padding: 8px 12px; font-weight: 600; cursor: pointer; 
                           background: var(--input-bg); border: 1px solid var(--border); 
                           border-radius: 8px; color: var(--text); flex-shrink: 0;"
                    aria-expanded="false" 
                    aria-controls="left-sidebar-nav">
                Menu
            </button>
            
            <div class="wrap" style="padding: 0;">
                <nav class="toc" aria-label="Mục lục nhanh các thời kỳ">
                    <a href="#prehistoric" data-target="prehistoric" class="active">Tiền sử</a>
                    <a href="#ancient" data-target="ancient">Cổ đại</a>
                    <a href="#northern" data-target="northern">Bắc thuộc</a>
                    <a href="#monarchy" data-target="monarchy">Quân chủ</a>
                    <a href="#modern" data-target="modern">Hiện đại</a>
                    <a href="#names" data-target="names">Quốc hiệu</a>
                    <a href="#population" data-target="population">Dân số</a>
                    <a href="#wars" data-target="wars">Chiến tranh</a>
                    <a href="#see-also" data-target="see-also">Xem thêm</a>
                    </nav>
            </div>
      </header>

   <div class="content-area" style="text-align: center;">
  <div class="wrap">
    <div class="page-header">
      <h1 class="page-title">Dòng Chảy Lịch Sử</h1>
      <p class="page-subtitle">
        Tổng quan các giai đoạn chính trong lịch sử Việt Nam, từ thời tiền sử đến hiện đại.
      </p>
    </div>
  </div>
</div>


            <main class="card" role="main" aria-labelledby="main-content-heading">
                <div class="layout">
                    <div class="content">
                        <section id="intro" style="border: none; padding-bottom: 0;">
                            <div class="section-head">
                                <h2 id="main-content-heading" style="font-size: 2.2rem; border: none; padding-bottom: 0;">Hành trình Dân tộc</h2>
                            </div>
                            <p class="sub" style="font-size: 1.1rem; line-height: 1.8;">Bản tóm tắt này hệ thống hóa lịch sử Việt Nam qua các cột mốc và giai đoạn trọng yếu, làm nổi bật những biến chuyển về chính trị, văn hóa, xã hội. Nội dung được biên soạn và diễn giải lại, phù hợp cho việc tham khảo nhanh.</p>
                           
                        </section>

                        <section id="prehistoric" aria-labelledby="heading-prehistoric">
                            <h2 id="heading-prehistoric">Thời kỳ Tiền sử</h2>
                            <p class="small">Dấu tích con người từ thời đồ đá cũ đến nền văn hóa Đông Sơn rực rỡ.</p>
                            <h4>Thời đại Đồ đá</h4>
                            <p>Các nền văn hóa khảo cổ như Sơn Vi, Hòa Bình, Bắc Sơn cho thấy sự hiện diện sớm của con người, kỹ thuật chế tác công cụ đá phát triển, chuyển dần từ săn bắt, hái lượm sang nông nghiệp sơ khai.</p>
                            <h4>Thời đại Kim khí & Văn hóa Đông Sơn</h4>
                            <p>Sự xuất hiện của đồ đồng và sau đó là đồ sắt đánh dấu bước tiến lớn. Văn hóa Đông Sơn (khoảng 2500-2000 năm trước) với kỹ thuật đúc đồng đỉnh cao (trống đồng, vũ khí, đồ dùng) phản ánh một xã hội có tổ chức, nông nghiệp phát triển và tín ngưỡng đa dạng.</p>
                        </section>

                        <section id="ancient" aria-labelledby="heading-ancient">
                           <h2 id="heading-ancient">Thời kỳ Cổ đại</h2>
                           <p class="small">Giai đoạn hình thành các nhà nước sơ khai trên lãnh thổ Việt Nam.</p>
                           <h4>Kỷ Hồng Bàng & Nhà nước Văn Lang - Âu Lạc</h4>
                           <p>Truyền thuyết về các Vua Hùng dựng nước Văn Lang, sau đó An Dương Vương lập nước Âu Lạc với thành Cổ Loa. Đây là giai đoạn hình thành ý thức cộng đồng, nền tảng văn hóa và nhà nước.</p>
                           <h4>Giao thoa Văn hóa</h4>
                           <p>Thời kỳ này cũng chứng kiến sự giao lưu, tiếp xúc và cả xung đột với các nền văn hóa và thế lực chính trị khác trong khu vực, đặc biệt là từ phương Bắc.</p>
                        </section>

                        <section id="northern" aria-labelledby="heading-northern">
                           <h2 id="heading-northern">Thời kỳ Bắc thuộc</h2>
                           <p class="small">Giai đoạn hơn 1000 năm đấu tranh giành độc lập dân tộc.</p>
                           <h4>Dưới ách Đô hộ</h4>
                           <p>Từ năm 111 TCN đến năm 938 SCN, các triều đại phong kiến phương Bắc thay nhau cai trị, áp đặt chính sách đồng hóa văn hóa nhưng vấp phải sự kháng cự bền bỉ của người Việt.</p>
                           <h4>Các Cuộc Khởi nghĩa Tiêu biểu</h4>
                           <p>Tinh thần dân tộc được thể hiện qua các cuộc khởi nghĩa lớn như Hai Bà Trưng (40-43), Bà Triệu (248), Lý Bí (542-602) lập nước Vạn Xuân, Mai Thúc Loan (713-722), Phùng Hưng (776-791), và đỉnh cao là chiến thắng Bạch Đằng của Ngô Quyền (938), chấm dứt thời kỳ Bắc thuộc kéo dài.</p>
                        </section>

                        <section id="monarchy" aria-labelledby="heading-monarchy">
                           <h2 id="heading-monarchy">Thời kỳ Quân chủ Độc lập</h2>
                           <p class="small">Xây dựng và bảo vệ nền độc lập, phát triển văn hóa Đại Việt (939–1858).</p>
                           <h4>Các Triều đại Vàng son</h4>
                           <p>Các triều đại Ngô, Đinh, Tiền Lê, Lý, Trần, Hậu Lê đã củng cố nền độc lập, xây dựng nhà nước trung ương tập quyền, phát triển kinh tế nông nghiệp, thủ công nghiệp, mở mang bờ cõi và tạo dựng nền văn hóa Thăng Long rực rỡ. Chiến thắng quân xâm lược Mông-Nguyên (nhà Trần) và quân Minh (nhà Lê) là những trang sử hào hùng.</p>
                           <h4>Phân tranh & Suy yếu</h4>
                           <p>Từ thế kỷ XVI, đất nước rơi vào chia cắt (Nam-Bắc triều, Trịnh-Nguyễn phân tranh). Nhà Tây Sơn nổi lên thống nhất đất nước nhưng tồn tại ngắn ngủi. Nhà Nguyễn thành lập (1802), thống nhất lãnh thổ nhưng dần suy yếu trước áp lực từ phương Tây.</p>
                        </section>

                        <section id="modern" aria-labelledby="heading-modern">
                           <h2 id="heading-modern">Thời kỳ Hiện đại</h2>
                           <p class="small">Từ ách thuộc địa đến độc lập, thống nhất và đổi mới (1858 – nay).</p>
                           <h4>Pháp thuộc & Kháng chiến</h4>
                           <p>Pháp xâm lược và áp đặt chế độ thuộc địa (1858-1945). Các phong trào yêu nước chống Pháp liên tiếp nổ ra. Cách mạng Tháng Tám (1945) thành công, khai sinh nước Việt Nam Dân chủ Cộng hòa. Tiếp đó là cuộc kháng chiến chống Pháp (1945-1954) và chống Mỹ (1954-1975), đất nước tạm thời chia cắt rồi thống nhất vào năm 1975.</p>
                           <h4>Đổi mới và Hội nhập</h4>
                           <p>Từ năm 1986, Việt Nam thực hiện công cuộc Đổi Mới, chuyển đổi kinh tế, mở cửa hội nhập quốc tế, đạt được những thành tựu quan trọng về kinh tế-xã hội và nâng cao vị thế trên trường quốc tế.</p>
                        </section>

                        <section id="names" aria-labelledby="heading-names">
                           <h2 id="heading-names">Quốc hiệu qua các Thời kỳ</h2>
                           <p class="small">Tên gọi đất nước phản ánh chủ quyền và thể chế chính trị.</p>
                           <ul> <li><strong>Văn Lang, Âu Lạc:</strong> Thời kỳ cổ đại, gắn liền với truyền thuyết.</li> <li><strong>Vạn Xuân:</strong> Quốc hiệu thời vua Lý Nam Đế (Lý Bí).</li> <li><strong>Đại Cồ Việt:</strong> Thời Đinh, Tiền Lê.</li> <li><strong>Đại Việt:</strong> Quốc hiệu tồn tại lâu dài nhất, từ thời Lý đến cuối thời Tây Sơn.</li> <li><strong>Việt Nam:</strong> Dưới thời vua Gia Long (1804), sau đó gián đoạn và được sử dụng chính thức từ năm 1945 đến nay.</li> <li><strong>Đại Nam:</strong> Thời vua Minh Mạng đến trước 1945.</li> </ul>
                        </section>

                        <section id="population" aria-labelledby="heading-pop">
                           <h2 id="heading-pop">Ước tính Dân số</h2>
                           <p class="small">Sự phát triển dân số gắn liền với lịch sử khai phá và phát triển kinh tế.</p>
                           <table aria-label="Dân số ước tính"> <thead><tr><th>Giai đoạn</th><th>Ước tính / Ghi chú</th></tr></thead> <tbody> <tr><td>Tiền sử → Cổ đại</td><td>Các cộng đồng nhỏ, phân bố rải rác.</td></tr> <tr><td>Thời Lý-Trần</td><td>Khoảng vài triệu người, tập trung ở đồng bằng Bắc Bộ.</td></tr> <tr><td>Thời Nguyễn (TK 19)</td><td>Khoảng 6-10 triệu người.</td></tr> <tr><td>Giữa TK 20</td><td>Khoảng 20-30 triệu người.</td></tr> <tr><td>Hiện nay</td><td>Gần 100 triệu người, đô thị hóa tăng nhanh.</td></tr> </tbody> </table>
                        </section>

                        <section id="wars" aria-labelledby="heading-wars">
                           <h2 id="heading-wars">Các Cuộc chiến tranh Tiêu biểu</h2>
                           <p class="small">Lịch sử giữ nước hào hùng và những cuộc nội chiến đau thương.</p>
                           <ul> <li>**Chống Bắc thuộc:** Khởi nghĩa Hai Bà Trưng, Lý Bí, Triệu Quang Phục, Mai Thúc Loan, Phùng Hưng, chiến thắng Bạch Đằng (938).</li> <li>**Chống Ngoại xâm:** Kháng chiến chống Tống (Lý), chống Mông-Nguyên (Trần), chống Minh (Lê Lợi), chống Xiêm, chống Thanh (Tây Sơn), chống Pháp, chống Mỹ.</li> <li>**Nội chiến & Phân tranh:** Loạn 12 sứ quân, Nam-Bắc triều, Trịnh-Nguyễn phân tranh.</li> </ul>
                        </section>

                        <section id="see-also" aria-labelledby="heading-see">
                           <h2 id="heading-see">Xem thêm & Tham khảo</h2>
                           <ul> <li><a href="https://vi.wikipedia.org/wiki/L%E1%BB%8Bch_s%E1%BB%AD_Vi%E1%BB%87t_Nam" target="_blank" rel="noopener noreferrer">Bài viết chi tiết trên Wikipedia <span aria-hidden="true">↗</span></a></li> <li><a href="gallery.html">Kho Tư liệu Hình ảnh & Video</a></li> <li><a href="culture.html">Trang Văn hóa & Truyền thống</a></li> <li><a href="#">Niên biểu Lịch sử (Sắp có)</a></li> </ul>
                        </section>
                    </div>

                    <aside class="sidebar" aria-label="Thông tin bổ sung">
                    <div style="margin: 24px 0; border-radius: var(--radius); overflow:hidden; box-shadow: var(--shadow-light);">
                                <img src="images/dep.jpg" alt="Hình ảnh minh họa lịch sử Việt Nam" style="width:100%; height: 350px; object-fit: cover;" />
                            </div>

                        <div class="aside-box mini-tl">
                          <h3>Dòng chảy Thời gian</h3>
                          <div class="timeline" role="navigation" aria-label="Timeline tóm tắt">
                            <button class="tl-item" data-target="prehistoric" aria-label="Chuyển đến Thời kỳ Tiền sử"><div class="tl-dot"><span></span></div><div class="tl-text"><div class="t">Tiền sử</div><div class="d">Văn hóa đồ đá, Đông Sơn</div></div></button>
                            <button class="tl-item" data-target="ancient" aria-label="Chuyển đến Thời kỳ Cổ đại"><div class="tl-dot"><span></span></div><div class="tl-text"><div class="t">Cổ đại</div><div class="d">Văn Lang, Âu Lạc</div></div></button>
                            <button class="tl-item" data-target="northern" aria-label="Chuyển đến Thời kỳ Bắc thuộc"><div class="tl-dot"><span></span></div><div class="tl-text"><div class="t">Bắc thuộc</div><div class="d">Đấu tranh giành độc lập</div></div></button>
                            <button class="tl-item" data-target="monarchy" aria-label="Chuyển đến Thời kỳ Quân chủ"><div class="tl-dot"><span></span></div><div class="tl-text"><div class="t">Quân chủ</div><div classd="d">Xây dựng Đại Việt</div></div></button>
                            <button class="tl-item" data-target="modern" aria-label="Chuyển đến Thời kỳ Hiện đại"><div class="tl-dot"><span></span></div><div class="tl-text"><div class="t">Hiện đại</div><div class="d">Thống nhất, Đổi mới</div></div></button>
                          </div>
                        </div>

                        <div class="aside-box">
                          <h3>Ghi chú</h3>
                          <p class="muted" style="font-size: 0.9rem; line-height: 1.6;">Nội dung trang này mang tính tổng hợp, tóm tắt dựa trên các nguồn tham khảo phổ biến (chủ yếu là Wikipedia Tiếng Việt). Để nghiên cứu sâu, vui lòng tham khảo các công trình sử học chuyên khảo.</p>
                        </div>
                      </div>
                    </aside>

                </div> </main>

            <footer>
                <div class="footer-content">
                    <div class="footer-column">
                        <h4>Giới thiệu</h4>
                        <p>Trang web "Dòng Chảy Lịch Sử" cung cấp thông tin tóm tắt về lịch sử Việt Nam qua các thời kỳ, phục vụ mục đích tham khảo và học tập.</p>
                    </div>
                    <div class="footer-column">
                        <h4>Liên hệ</h4>
                        <a href="mailto:info@lichsuviet.vn">Email: info@lichsuviet.vn</a>
                        <a href="tel:+84123456789">Điện thoại: (012) 345-6789</a>
                        <p>Địa chỉ: 123 Đường ABC, Hà Nội</p>
                    </div>
                    <div class="footer-column">
                        <h4>Hỗ trợ</h4>
                        <a href="faq.html">Câu hỏi thường gặp</a>
                        <a href="lienhe.html">Góp ý nội dung</a>
                        <a href="policy.html">Chính sách bảo mật</a>
                    </div>
                </div>
                <div class="wrap"> <div class="footer-copyright">
                 <p class="muted" style="color: red; font-weight: bold; font-size: 20px; text-align: center;">
  🇻🇳 Hoàng Sa, Trường Sa là của Việt Nam 🇻🇳
</p>

                        <p class="muted">© Dòng Chảy Lịch Sử Việt . Made by Bùi Lê Hậu . Thông tin tổng hợp cho mục đích tham khảo.</p>
                        
                    </div>
                </div>
            </footer>
            </div> </div> </div> <div id="mobile-nav-overlay" class="mobile-nav-overlay" aria-hidden="true">
   </div>

  <script>
    // --- JavaScript Section ---
    (function(){
      const htmlEl = document.documentElement;
      const themeToggleBtn = document.getElementById('theme-toggle');
      const themeIconLight = themeToggleBtn?.querySelector('.theme-icon-light');
      const themeIconDark = themeToggleBtn?.querySelector('.theme-icon-dark');
      const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
      const mobileNavOverlay = document.getElementById('mobile-nav-overlay');
      const mobileNavClose = document.getElementById('mobile-nav-close');
      const tocLinks = document.querySelectorAll('nav.toc a');
      const tlItems = document.querySelectorAll('.tl-item'); // Mini timeline items
      const sections = document.querySelectorAll('main.card section[id]');
      const stickyTocHeader = document.querySelector('.sticky-toc-header');

      // --- START ĐÃ THÊM (Toggle Sidebar Trái) ---
      const sidebarToggleButton = document.getElementById('sidebar-toggle-button');
      const bodyEl = document.body;
      
      if (sidebarToggleButton && bodyEl) {
          // Đặt trạng thái ban đầu của nút (aria-expanded)
          const isSidebarHidden = bodyEl.classList.contains('sidebar-hidden');
          sidebarToggleButton.setAttribute('aria-expanded', !isSidebarHidden);

          sidebarToggleButton.addEventListener('click', () => {
              bodyEl.classList.toggle('sidebar-hidden');
              const isNowHidden = bodyEl.classList.contains('sidebar-hidden');
              sidebarToggleButton.setAttribute('aria-expanded', !isNowHidden);
          });
      }
      // --- END ĐÃ THÊM (Toggle Sidebar Trái) ---

      // Theme toggle
      function applyTheme(theme) {
          htmlEl.setAttribute('data-theme', theme);
          localStorage.setItem('dcl_theme_v6', theme);
          if (themeIconLight && themeIconDark) {
               themeIconLight.classList.toggle('hidden', theme === 'dark');
               themeIconDark.classList.toggle('hidden', theme === 'light');
          }
      }
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      const storedTheme = localStorage.getItem('dcl_theme_v6') || (prefersDark ? 'dark' : 'light');
      applyTheme(storedTheme);
      themeToggleBtn?.addEventListener('click', ()=> {
        const newTheme = htmlEl.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
        applyTheme(newTheme);
      });

      // Mobile Menu
       function openMobileNav() { mobileNavOverlay.style.display = 'flex'; mobileNavOverlay.setAttribute('aria-hidden', 'false'); mobileMenuToggle?.setAttribute('aria-expanded', 'true'); document.body.style.overflow = 'hidden'; mobileNavClose?.focus(); }
       function closeMobileNav() { mobileNavOverlay.style.display = 'none'; mobileNavOverlay.setAttribute('aria-hidden', 'true'); mobileMenuToggle?.setAttribute('aria-expanded', 'false'); document.body.style.overflow = ''; mobileMenuToggle?.focus(); }
       mobileMenuToggle?.addEventListener('click', openMobileNav);
       mobileNavClose?.addEventListener('click', closeMobileNav);
       mobileNavOverlay?.querySelectorAll('a').forEach(link => { link.addEventListener('click', closeMobileNav); });
        function checkMobileToggleDisplay() {
            const isMobile = window.innerWidth <= 1250; // Match CSS breakpoint for hiding sidebar
             mobileMenuToggle?.classList.toggle('hidden', !isMobile);
             // Logic khác nếu cần
        }
       checkMobileToggleDisplay(); window.addEventListener('resize', checkMobileToggleDisplay);

      // Smooth Scroll & Highlight (TOC & Mini Timeline)
      document.querySelectorAll('nav.toc a, .tl-item').forEach(function(el){
          el.addEventListener('click', function(e){
              const targetId = this.getAttribute('data-target');
              if (!targetId) return;
              const targetElement = document.getElementById(targetId);
              if (targetElement) {
                  e.preventDefault();
                  const tocHeaderOffset = stickyTocHeader?.offsetHeight || 68;
                  const elementPosition = targetElement.getBoundingClientRect().top;
                  // Scroll tới vị trí section trừ đi chiều cao header TOC và 1 khoảng đệm
                  const offsetPosition = window.pageYOffset + elementPosition - tocHeaderOffset - 20;

                  window.scrollTo({ top: offsetPosition, behavior: 'smooth' });

                  // Highlight
                  targetElement.style.transition = 'box-shadow 0.3s ease-in-out, background-color 0.3s ease-in-out';
                  targetElement.style.backgroundColor = 'rgba(var(--accent-rgb), 0.05)';
                  targetElement.style.boxShadow = 'inset 4px 0 0 0 var(--accent)';
                  setTimeout(() => { targetElement.style.backgroundColor = ''; targetElement.style.boxShadow = ''; }, 1200);
              }
          });
          el.addEventListener('keydown', function(e){ if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); this.click(); } });
      });

      // Scroll Spy (Intersection Observer)
      if ('IntersectionObserver' in window && sections.length > 0 && tocLinks.length > 0 && tlItems.length > 0) {
          const mapToc = {}; tocLinks.forEach(a => mapToc[a.getAttribute('data-target')] = a);
          const mapTl = {}; tlItems.forEach(t => mapTl[t.getAttribute('data-target')] = t);

          const observerCallback = (entries) => {
              let intersectingEntry = null; let maxRatio = 0;
              entries.forEach(entry => { /* ... Tìm entry phù hợp nhất ... */
                   if (entry.isIntersecting) { if (entry.intersectionRatio > maxRatio) { maxRatio = entry.intersectionRatio; intersectingEntry = entry; } else if (entry.intersectionRatio === maxRatio && (!intersectingEntry || entry.boundingClientRect.top < intersectingEntry.boundingClientRect.top)) { intersectingEntry = entry; } }
              });

              tocLinks.forEach(a => a.classList.remove('active'));
              tlItems.forEach(t => t.classList.remove('active-item'));

               if (intersectingEntry) {
                   const id = intersectingEntry.target.id;
                   if (mapToc[id]) mapToc[id].classList.add('active');
                   if (mapTl[id]) mapTl[id].classList.add('active-item');

                   const activeTocLink = mapToc[id]; const tocNav = document.querySelector('nav.toc');
                   if(activeTocLink && tocNav && tocNav.scrollWidth > tocNav.clientWidth) { /* ... Scroll TOC nếu cần ... */
                        const linkRect = activeTocLink.getBoundingClientRect(); const tocRect = tocNav.getBoundingClientRect(); if (linkRect.left < tocRect.left + 10) { tocNav.scrollBy({ left: linkRect.left - tocRect.left - 30, behavior: 'smooth'}); } else if (linkRect.right > tocRect.right - 10) { tocNav.scrollBy({ left: linkRect.right - tocRect.right + 30, behavior: 'smooth'}); }
                   }

                   const activeTlItem = mapTl[id]; const sidebarSticky = document.querySelector('aside.sidebar .sticky');
                   if (sidebarSticky && activeTlItem) { /* ... Scroll sidebar nếu cần ... */
                       const itemRect = activeTlItem.getBoundingClientRect(); const sidebarRect = sidebarSticky.getBoundingClientRect(); const isAbove = itemRect.top < sidebarRect.top + 20; const isBelow = itemRect.bottom > sidebarRect.bottom - 20; if (isAbove || isBelow) { activeTlItem.scrollIntoView({ behavior: 'smooth', block: 'nearest' }); }
                   }
               }
          };

          const tocHeaderHeight = stickyTocHeader?.offsetHeight || 68;
          // Điều chỉnh rootMargin chỉ dựa trên TOC Header vì không có Header chính cố định nữa
          const observerOptions = { rootMargin: `-${tocHeaderHeight + 20}px 0px -45% 0px`, threshold: [0, 0.1, 0.5, 0.9] }; // Tăng threshold
          const observer = new IntersectionObserver(observerCallback, observerOptions);
          sections.forEach(s => observer.observe(s));
      } else { console.log("Scroll spy initialization failed."); }

       // Escape key closes mobile nav
        document.addEventListener('keydown', (e)=> { if(e.key === 'Escape'){ if (mobileNavOverlay?.style.display === 'flex') { closeMobileNav(); } } });

    })();
  </script>
  
</body>
</html>